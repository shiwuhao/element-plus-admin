import{_ as at}from"./PageWrapper.8aec7a08.js";import{r as A,by as H,A as ht,bz as kt,bA as Lt,b as $t,ba as Nt,o as ut,f as Dt,w as tt,h as Ct,c as At,x as lt}from"./vendor.55f737cb.js";/* empty css                */import{_ as Ot}from"./index.3250e07d.js";import"../../../../at.alicdn.com/t/font_2915553_2xnkr1mdevd.js";import"../../../../at.alicdn.com/t/font_2915337_b0wn8zcpm25.js";import"../../../../at.alicdn.com/t/font_1804572_162pxjij64s.js";function ct(t,e,s,r=n=>n){return t*r(.5-e*(.5-s))}function It(t){return[-t[0],-t[1]]}function w(t,e){return[t[0]+e[0],t[1]+e[1]]}function _(t,e){return[t[0]-e[0],t[1]-e[1]]}function x(t,e){return[t[0]*e,t[1]*e]}function jt(t,e){return[t[0]/e,t[1]/e]}function V(t){return[t[1],-t[0]]}function Tt(t,e){return t[0]*e[0]+t[1]*e[1]}function zt(t,e){return t[0]===e[0]&&t[1]===e[1]}function Rt(t){return Math.hypot(t[0],t[1])}function Ht(t){return t[0]*t[0]+t[1]*t[1]}function dt(t,e){return Ht(_(t,e))}function ft(t){return jt(t,Rt(t))}function Vt(t,e){return Math.hypot(t[1]-e[1],t[0]-e[0])}function F(t,e,s){let r=Math.sin(s),n=Math.cos(s),i=t[0]-e[0],a=t[1]-e[1],o=i*n-a*r,l=i*r+a*n;return[o+e[0],l+e[1]]}function et(t,e,s){return w(t,x(_(e,t),s))}function pt(t,e,s){return w(t,x(e,s))}var{min:j,PI:Ft}=Math,mt=.275,q=Ft+1e-4;function qt(t,e={}){let{size:s=16,smoothing:r=.5,thinning:n=.5,simulatePressure:i=!0,easing:a=u=>u,start:o={},end:l={},last:y=!1}=e,{cap:b=!0,taper:v=0,easing:O=u=>u*(2-u)}=o,{cap:f=!0,taper:p=0,easing:S=u=>--u*u*u+1}=l;if(t.length===0||s<=0)return[];let T=t[t.length-1].runningLength,B=Math.pow(s*r,2),$=[],P=[],I=t.slice(0,10).reduce((u,g)=>{let c=g.pressure;if(i){let d=j(1,g.distance/s),J=j(1,1-d);c=j(1,u+(J-u)*(d*mt))}return(u+c)/2},t[0].pressure),m=ct(s,n,t[t.length-1].pressure,a),h,N=t[0].vector,z=t[0].point,G=z,D=z,C=G;for(let u=0;u<t.length;u++){let{pressure:g}=t[u],{point:c,vector:d,distance:J,runningLength:R}=t[u];if(u<t.length-1&&T-R<3)continue;if(n){if(i){let L=j(1,J/s),Z=j(1,1-L);g=j(1,I+(Z-I)*(L*mt))}m=ct(s,n,g,a)}else m=s/2;h===void 0&&(h=m);let Pt=R<v?O(R/v):1,Mt=T-R<p?S((T-R)/p):1;if(m=Math.max(.01,m*Math.min(Pt,Mt)),u===t.length-1){let L=x(V(d),m);$.push(_(c,L)),P.push(w(c,L));continue}let nt=t[u+1].vector,it=Tt(d,nt);if(it<0){let L=x(V(N),m);for(let Z=1/13,X=0;X<=1;X+=Z)D=F(_(c,L),c,q*X),$.push(D),C=F(w(c,L),c,q*-X),P.push(C);z=D,G=C;continue}let ot=x(V(et(nt,d,it)),m);D=_(c,ot),(u<=1||dt(z,D)>B)&&($.push(D),z=D),C=w(c,ot),(u<=1||dt(G,C)>B)&&(P.push(C),G=C),I=g,N=d}let M=t[0].point.slice(0,2),k=t.length>1?t[t.length-1].point.slice(0,2):w(t[0].point,[1,1]),Q=[],K=[];if(t.length===1){if(!(v||p)||y){let u=pt(M,ft(V(_(M,k))),-(h||m)),g=[];for(let c=1/13,d=c;d<=1;d+=c)g.push(F(u,M,q*2*d));return g}}else{if(!(v||p&&t.length===1))if(b)for(let g=1/13,c=g;c<=1;c+=g){let d=F(P[0],M,q*c);Q.push(d)}else{let g=_($[0],P[0]),c=x(g,.5),d=x(g,.51);Q.push(_(M,c),_(M,d),w(M,d),w(M,c))}let u=V(It(t[t.length-1].vector));if(p||v&&t.length===1)K.push(k);else if(f){let g=pt(k,u,m);for(let c=1/29,d=c;d<1;d+=c)K.push(F(g,k,q*3*d))}else K.push(w(k,x(u,m)),w(k,x(u,m*.99)),_(k,x(u,m*.99)),_(k,x(u,m)))}return $.concat(K,P.reverse(),Q)}function Ut(t,e={}){var s;let{streamline:r=.5,size:n=16,last:i=!1}=e;if(t.length===0)return[];let a=.15+(1-r)*.85,o=Array.isArray(t[0])?t:t.map(({x:f,y:p,pressure:S=.5})=>[f,p,S]);if(o.length===2){let f=o[1];o=o.slice(0,-1);for(let p=1;p<5;p++)o.push(et(o[0],f,p/4))}o.length===1&&(o=[...o,[...w(o[0],[1,1]),...o[0].slice(2)]]);let l=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],y=!1,b=0,v=l[0],O=o.length-1;for(let f=1;f<o.length;f++){let p=i&&f===O?o[f].slice(0,2):et(v.point,o[f],a);if(zt(v.point,p))continue;let S=Vt(p,v.point);if(b+=S,f<O&&!y){if(b<n)continue;y=!0}v={point:p,pressure:o[f][2]>=0?o[f][2]:.5,vector:ft(_(v.point,p)),distance:S,runningLength:b},l.push(v)}return l[0].vector=((s=l[1])==null?void 0:s.vector)||[0,0],l}function Bt(t,e={}){return qt(Ut(t,e),e)}var Gt=Bt,Kt=Object.defineProperty,gt=Object.getOwnPropertySymbols,Xt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,vt=(t,e,s)=>e in t?Kt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,st=(t,e)=>{for(var s in e||(e={}))Xt.call(e,s)&&vt(t,s,e[s]);if(gt)for(var s of gt(e))Yt.call(e,s)&&vt(t,s,e[s]);return t};var Wt=()=>({events:{},emit(t,...e){(this.events[t]||[]).forEach(s=>s(...e))},on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=(this.events[t]||[]).filter(s=>s!==e)}});function Y(t,e){return t-e}function Qt(t){return t<0?-1:1}function W(t){return[Math.abs(t),Qt(t)]}function yt(){const t=()=>((1+Math.random())*65536|0).toString(16).substring(1);return`${t()+t()}-${t()}-${t()}-${t()}-${t()}${t()}${t()}`}var Jt=2,E=Jt,U=class{constructor(t){this.drauu=t,this.event=void 0,this.point=void 0,this.start=void 0,this.el=null}onStart(t){}onMove(t){return!1}onEnd(t){}get brush(){return this.drauu.brush}get shiftPressed(){return this.drauu.shiftPressed}get altPressed(){return this.drauu.altPressed}getMousePosition(t){var e,s;const r=this.drauu.el,n=(e=this.drauu.options.coordinateScale)!=null?e:1;if(this.drauu.options.coordinateTransform===!1){const i=this.drauu.el.getBoundingClientRect();return{x:(t.pageX-i.left)*n,y:(t.pageY-i.top)*n,pressure:t.pressure}}else{const i=this.drauu.svgPoint;i.x=t.clientX,i.y=t.clientY;const a=i.matrixTransform((s=r.getScreenCTM())==null?void 0:s.inverse());return{x:a.x*n,y:a.y*n,pressure:t.pressure}}}createElement(t,e){var s;const r=document.createElementNS("http://www.w3.org/2000/svg",t),n=e?st(st({},this.brush),e):this.brush;return r.setAttribute("fill",(s=n.fill)!=null?s:"transparent"),r.setAttribute("stroke",n.color),r.setAttribute("stroke-width",n.size.toString()),r.setAttribute("stroke-linecap","round"),n.dasharray&&r.setAttribute("stroke-dasharray",n.dasharray),r}attr(t,e){this.el.setAttribute(t,typeof e=="string"?e:e.toFixed(E))}_setEvent(t){this.event=t,this.point=this.getMousePosition(t)}_eventDown(t){return this._setEvent(t),this.start=this.point,this.onStart(this.point)}_eventMove(t){return this._setEvent(t),this.onMove(this.point)}_eventUp(t){return this._setEvent(t),this.onEnd(this.point)}},Zt=class extends U{constructor(){super(...arguments);this.points=[]}onStart(t){return this.el=document.createElementNS("http://www.w3.org/2000/svg","path"),this.points=[t],this.attr("fill",this.brush.color),this.attr("d",this.getSvgData(this.points)),this.el}onMove(t){return this.el||this.onStart(t),this.points[this.points.length-1]!==t&&this.points.push(t),this.attr("d",this.getSvgData(this.points)),!0}onEnd(){const t=this.el;return this.el=null,!!t}getSvgData(t){const e=Gt(t,st({size:this.brush.size*2,thinning:.9,simulatePressure:!1,start:{taper:5},end:{taper:5}},this.brush.stylusOptions));if(!e.length)return"";const s=e.reduce((r,[n,i],a,o)=>{const[l,y]=o[(a+1)%o.length];return r.push(n,i,(n+l)/2,(i+y)/2),r},["M",...e[0],"Q"]);return s.push("Z"),s.map(r=>typeof r=="number"?r.toFixed(2):r).join(" ")}},te=class extends U{onStart(t){return this.el=this.createElement("ellipse"),this.attr("cx",t.x),this.attr("cy",t.y),this.el}onMove(t){if(!this.el||!this.start)return!1;let[e,s]=W(t.x-this.start.x),[r,n]=W(t.y-this.start.y);if(this.shiftPressed){const i=Math.min(e,r);e=i,r=i}if(this.altPressed)this.attr("cx",this.start.x),this.attr("cy",this.start.y),this.attr("rx",e),this.attr("ry",r);else{const[i,a]=[this.start.x,this.start.x+e*s].sort(Y),[o,l]=[this.start.y,this.start.y+r*n].sort(Y);this.attr("cx",(i+a)/2),this.attr("cy",(o+l)/2),this.attr("rx",(a-i)/2),this.attr("ry",(l-o)/2)}return!0}onEnd(){const t=this.el;return this.el=null,!(!t||!t.getTotalLength())}};function _t(t,e){const s=document.createElementNS("http://www.w3.org/2000/svg","defs"),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("fill",e),r.setAttribute("id",t),r.setAttribute("viewBox","0 -5 10 10"),r.setAttribute("refX","5"),r.setAttribute("refY","0"),r.setAttribute("markerWidth","4"),r.setAttribute("markerHeight","4"),r.setAttribute("orient","auto"),n.setAttribute("d","M0,-5L10,0L0,5"),r.appendChild(n),s.appendChild(r),s}var ee=class extends U{onStart(t){if(this.el=this.createElement("line",{fill:"transparent"}),this.attr("x1",t.x),this.attr("y1",t.y),this.attr("x2",t.x),this.attr("y2",t.y),this.brush.arrowEnd){const e=yt(),s=document.createElementNS("http://www.w3.org/2000/svg","g");return s.append(_t(e,this.brush.color)),s.append(this.el),this.attr("marker-end",`url(#${e})`),s}return this.el}onMove(t){if(!this.el)return!1;let{x:e,y:s}=t;if(this.shiftPressed){const r=t.x-this.start.x,n=t.y-this.start.y;if(n!==0){let i=r/n;i=Math.round(i),Math.abs(i)<=1?(e=this.start.x+n*i,s=this.start.y+n):(e=this.start.x+r,s=this.start.y)}}return this.altPressed?(this.attr("x1",this.start.x*2-e),this.attr("y1",this.start.y*2-s),this.attr("x2",e),this.attr("y2",s)):(this.attr("x1",this.start.x),this.attr("y1",this.start.y),this.attr("x2",e),this.attr("y2",s)),!0}onEnd(){const t=this.el;return this.el=null,!(!t||t.getTotalLength()<5)}},se=class extends U{onStart(t){return this.el=this.createElement("rect"),this.brush.cornerRadius&&(this.attr("rx",this.brush.cornerRadius),this.attr("ry",this.brush.cornerRadius)),this.attr("x",t.x),this.attr("y",t.y),this.el}onMove(t){if(!this.el||!this.start)return!1;let[e,s]=W(t.x-this.start.x),[r,n]=W(t.y-this.start.y);if(this.shiftPressed){const i=Math.min(e,r);e=i,r=i}if(this.altPressed)this.attr("x",this.start.x-e),this.attr("y",this.start.y-r),this.attr("width",e*2),this.attr("height",r*2);else{const[i,a]=[this.start.x,this.start.x+e*s].sort(Y),[o,l]=[this.start.y,this.start.y+r*n].sort(Y);this.attr("x",i),this.attr("y",o),this.attr("width",a-i),this.attr("height",l-o)}return!0}onEnd(){const t=this.el;return this.el=null,!(!t||!t.getTotalLength())}};function re(t,e){const s=t.x-e.x,r=t.y-e.y;return s*s+r*r}function ne(t,e,s){let r=e.x,n=e.y,i=s.x-r,a=s.y-n;if(i!==0||a!==0){const o=((t.x-r)*i+(t.y-n)*a)/(i*i+a*a);o>1?(r=s.x,n=s.y):o>0&&(r+=i*o,n+=a*o)}return i=t.x-r,a=t.y-n,i*i+a*a}function ie(t,e){let s=t[0];const r=[s];let n;for(let i=1,a=t.length;i<a;i++)n=t[i],re(n,s)>e&&(r.push(n),s=n);return s!==n&&n&&r.push(n),r}function rt(t,e,s,r,n){let i=r,a=0;for(let o=e+1;o<s;o++){const l=ne(t[o],t[e],t[s]);l>i&&(a=o,i=l)}i>r&&(a-e>1&&rt(t,e,a,r,n),n.push(t[a]),s-a>1&&rt(t,a,s,r,n))}function oe(t,e){const s=t.length-1,r=[t[0]];return rt(t,0,s,e,r),r.push(t[s]),r}function wt(t,e,s=!1){if(t.length<=2)return t;const r=e!==void 0?e*e:1;return t=s?t:ie(t,r),t=oe(t,r),t}var ae=class extends U{constructor(){super(...arguments);this.points=[],this.count=0}onStart(t){if(this.el=this.createElement("path",{fill:"transparent"}),this.points=[t],this.brush.arrowEnd){this.arrowId=yt();const e=_t(this.arrowId,this.brush.color);this.el.appendChild(e)}return this.el}onMove(t){return this.el||this.onStart(t),this.points[this.points.length-1]!==t&&(this.points.push(t),this.count+=1),this.count>5&&(this.points=wt(this.points,1,!0),this.count=0),this.attr("d",bt(this.points)),!0}onEnd(){const t=this.el;return this.el=null,!(!t||(t.setAttribute("d",bt(wt(this.points,1,!0))),!t.getTotalLength()))}};function he(t,e){const s=e.x-t.x,r=e.y-t.y;return{length:Math.sqrt(Math.pow(s,2)+Math.pow(r,2)),angle:Math.atan2(r,s)}}function xt(t,e,s,r){const n=e||t,i=s||t,a=.2,o=he(n,i),l=o.angle+(r?Math.PI:0),y=o.length*a,b=t.x+Math.cos(l)*y,v=t.y+Math.sin(l)*y;return{x:b,y:v}}function ue(t,e,s){const r=xt(s[e-1],s[e-2],t),n=xt(t,s[e-1],s[e+1],!0);return`C ${r.x.toFixed(E)},${r.y.toFixed(E)} ${n.x.toFixed(E)},${n.y.toFixed(E)} ${t.x.toFixed(E)},${t.y.toFixed(E)}`}function bt(t){return t.reduce((e,s,r,n)=>r===0?`M ${s.x.toFixed(E)},${s.y.toFixed(E)}`:`${e} ${ue(s,r,n)}`,"")}function le(t){return{draw:new ae(t),stylus:new Zt(t),line:new ee(t),rectangle:new se(t),ellipse:new te(t)}}var ce=class{constructor(t={}){this.options=t,this.el=null,this.svgPoint=null,this.eventEl=null,this.shiftPressed=!1,this.altPressed=!1,this.drawing=!1,this._emitter=Wt(),this._models=le(this),this._undoStack=[],this._disposables=[],this.options.brush||(this.options.brush={color:"black",size:3,mode:"stylus"}),t.el&&this.mount(t.el,t.eventTarget)}get model(){return this._models[this.mode]}get mounted(){return!!this.el}get mode(){return this.options.brush.mode||"stylus"}set mode(t){this.options.brush.mode=t}get brush(){return this.options.brush}set brush(t){this.options.brush=t}resolveSelector(t){return typeof t=="string"?document.querySelector(t):t||null}mount(t,e){if(this.el)throw new Error("[drauu] already mounted, unmount previous target first");if(this.el=this.resolveSelector(t),!this.el)throw new Error("[drauu] target element not found");if(this.el.tagName.toLocaleLowerCase()!=="svg")throw new Error("[drauu] can only mount to a SVG element");if(!this.el.createSVGPoint)throw new Error("[drauu] SVG element must be create by document.createElementNS('http://www.w3.org/2000/sv', 'svg')");this.svgPoint=this.el.createSVGPoint();const s=this.resolveSelector(e)||this.el,r=this.eventStart.bind(this),n=this.eventMove.bind(this),i=this.eventEnd.bind(this),a=this.eventKeyboard.bind(this);s.addEventListener("pointerdown",r,{passive:!1}),window.addEventListener("pointermove",n,{passive:!1}),window.addEventListener("pointerup",i,{passive:!1}),window.addEventListener("pointercancel",i,{passive:!1}),window.addEventListener("keydown",a,!1),window.addEventListener("keyup",a,!1),this._disposables.push(()=>{s.removeEventListener("pointerdown",r),window.removeEventListener("pointermove",n),window.removeEventListener("pointerup",i),window.removeEventListener("pointercancel",i),window.removeEventListener("keydown",a,!1),window.removeEventListener("keyup",a,!1)}),this._emitter.emit("mounted")}unmount(){this._disposables.forEach(t=>t()),this._disposables.length=0,this.el=null,this._emitter.emit("unmounted")}on(t,e){return this._emitter.on(t,e)}undo(){const t=this.el;return t.lastElementChild?(this._undoStack.push(t.lastElementChild.cloneNode(!0)),t.lastElementChild.remove(),this._emitter.emit("changed"),!0):!1}redo(){return this._undoStack.length?(this.el.appendChild(this._undoStack.pop()),this._emitter.emit("changed"),!0):!1}canRedo(){return!!this._undoStack.length}canUndo(){var t;return!!((t=this.el)==null?void 0:t.lastElementChild)}eventMove(t){!this.acceptsInput(t)||!this.drawing||this.model._eventMove(t)&&(t.stopPropagation(),t.preventDefault(),this._emitter.emit("changed"))}eventStart(t){!this.acceptsInput(t)||(t.stopPropagation(),t.preventDefault(),this._currentNode&&this.cancel(),this.drawing=!0,this._emitter.emit("start"),this._currentNode=this.model._eventDown(t),this._currentNode&&this.el.appendChild(this._currentNode),this._emitter.emit("changed"))}eventEnd(t){if(!this.acceptsInput(t)||!this.drawing)return;const e=this.model._eventUp(t);e?(e instanceof Element&&e!==this._currentNode&&(this._currentNode=e),this.commit()):this.cancel(),this.drawing=!1,this._emitter.emit("end"),this._emitter.emit("changed")}acceptsInput(t){return!this.options.acceptsInputTypes||this.options.acceptsInputTypes.includes(t.pointerType)}eventKeyboard(t){this.shiftPressed===t.shiftKey&&this.altPressed===t.altKey||(this.shiftPressed=t.shiftKey,this.altPressed=t.altKey,this.model.point&&this.model.onMove(this.model.point)&&this._emitter.emit("changed"))}commit(){this._undoStack.length=0;const t=this._currentNode;this._currentNode=void 0,this._emitter.emit("committed",t)}clear(){this._undoStack.length=0,this.cancel(),this.el.innerHTML="",this._emitter.emit("changed")}cancel(){this._currentNode&&(this.el.removeChild(this._currentNode),this._currentNode=void 0,this._emitter.emit("canceled"))}dump(){return this.el.innerHTML}load(t){this.clear(),this.el.innerHTML=t}};function de(t){return new ce(t)}var fe=Object.defineProperty,Et=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable,St=(t,e,s)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ge=(t,e)=>{for(var s in e||(e={}))pe.call(e,s)&&St(t,s,e[s]);if(Et)for(var s of Et(e))me.call(e,s)&&St(t,s,e[s]);return t};function ve(t,e){const s=A();let r=[];const n=H(),i=H(),a=H(),o=H(),l=H(),y=A(!1),b=A(!1),v=A(!1),O=A(!1),f=A({color:"black",size:3,arrowEnd:!1,cornerRadius:0,dasharray:void 0,fill:"transparent",mode:"draw"});ht(f,()=>{const h=s.value;h&&(h.brush=f.value)},{deep:!0});const p=()=>{var h;return(h=s.value)==null?void 0:h.undo()},S=()=>{var h;return(h=s.value)==null?void 0:h.redo()},T=()=>{var h;return(h=s.value)==null?void 0:h.clear()},B=()=>{var h;return(h=s.value)==null?void 0:h.cancel()},$=h=>{var N;return(N=s.value)==null?void 0:N.load(h)},P=()=>{var h;return(h=s.value)==null?void 0:h.dump()},I=()=>{var h;r.forEach(N=>N()),(h=s.value)==null||h.unmount()},m=()=>{s.value&&(y.value=s.value.canUndo(),b.value=s.value.canRedo(),v.value=s.value.altPressed,O.value=s.value.shiftPressed)};return ht(()=>kt(t),h=>{!h||!(h instanceof SVGSVGElement)||(s.value&&I(),s.value=de(ge({el:h},e)),m(),r=[s.value.on("canceled",()=>i.trigger()),s.value.on("committed",()=>a.trigger()),s.value.on("start",()=>o.trigger()),s.value.on("end",()=>l.trigger()),s.value.on("changed",()=>{m(),n.trigger()})])},{flush:"post"}),Lt(()=>I()),{drauuInstance:s,load:$,dump:P,clear:T,cancel:B,undo:p,redo:S,canUndo:y,canRedo:b,brush:f,onChanged:n.on,onCommitted:a.on,onStart:o.on,onEnd:l.on,onCanceled:i.on}}const ye={name:"index",components:{PageWrapper:at},setup(){const t=A(),{undo:e,redo:s,canUndo:r,canRedo:n,brush:i}=ve(t),{color:a,size:o}=$t(i);return{target:t,undo:e,redo:s,canUndo:r,canRedo:n,brush:i,color:a,size:o}}},_e=lt(" \u4F7F\u7528VueUse useDrauu "),we=lt("\u67E5\u770B"),xe={ref:"target",style:{width:"500px",height:"500px",background:"white"}};function be(t,e,s,r,n,i){const a=Nt,o=at;return ut(),Dt(o,{title:t.$route.meta.title},{content:tt(()=>[_e,Ct(a,{type:"primary",href:"https://vueuse.org/integrations/useDrauu/",target:"_blank"},{default:tt(()=>[we]),_:1})]),default:tt(()=>[(ut(),At("svg",xe,null,512))]),_:1},8,["title"])}var Ne=Ot(ye,[["render",be]]);export{Ne as default};
