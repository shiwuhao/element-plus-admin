var Q=Object.defineProperty,S=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var U=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))F.call(t,r)&&U(e,r,t[r]);if(T)for(var r of T(t))H.call(t,r)&&U(e,r,t[r]);return e},v=(e,t)=>S(e,G(t));import{P as M}from"./PageWrapper.657356fd.js";import{B as O}from"./BasicQuery.vue_vue&type=style&index=0&scoped=true&lang.c9c419c8.js";import{B as J}from"./BasicQuery.33a98a39.js";import{B as K,u as X,a as Y}from"./useResourceApi.b82e986c.js";import{i as V,_ as P}from"./index.9f0666ad.js";import{$ as R,a0 as j,s as z,b as i,G as Z,o as y,x as w,w as a,H as x,e as o,B as A,c as $,v as ee,a as B,t as I,F as te,j as g,d as le,a1 as D,n as oe}from"./vendor.e9e2b289.js";import"./Form.5248ede4.js";const ae=(e={})=>V.get("/permissions",{params:e}),q=(e={})=>V.get("/permissions",{params:{pid:e}}),ne=(e={})=>V.get(`/permissions/${e.id}`),ie=(e={})=>V.put(`/permissions/${e.id}`,{pid:e.pid,type:e.type,name:e.name,title:e.title,url:e.url,icon:e.icon,status:e.status}),re=(e={})=>V.post("/permissions",{pid:e.pid,type:e.type,name:e.name,title:e.title,url:e.url,icon:e.icon,status:e.status}),se=(e={})=>V.delete(`/permissions/${e.id}`),de=(e={})=>V.post("/permissions/auto"),me={name:"editTemplate",components:{BasicDrawer:K},setup(){const e=R({rules:{pid:[{required:!0,message:"\u8BF7\u9009\u62E9\u7236\u7EA7\u8282\u70B9",trigger:"change"}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B",trigger:"change"}],name:[{required:!0,pattern:/^(\w|:){3,50}$/,message:"\u6807\u8BC6\u4E3A\u5FC5\u586B\u9879\uFF0C3-50\u4E2A\u82F1\u6587\u5B57\u7B26",trigger:"blur"}],title:[{required:!0,message:"\u8BF7\u8F93\u5165\u663E\u793A\u540D\u79F0",trigger:"blur"}],method:[{required:!0,message:"\u8BF7\u9009\u62E9\u8BF7\u6C42\u65B9\u5F0F",trigger:"change"}],url:[{required:!0,message:"\u8BF7\u8F93\u5165\u540E\u7AEFurl\u5730\u5740",trigger:"blur"}]}}),{getPermissionRoutes:t}=X(),r=j("childrenListApi"),{formRef:l,item:k,dialog:C,itemLoading:d,confirmLoading:_,cancelItem:m,confirmItem:b}=j("resourceApi"),s=async({level:u,data:c},f)=>{if(u===0)f([{id:0,pid:0,title:"\u6839\u8282\u70B9",children:[]}]);else{const{data:{data:p}}=await r(c.id);f(p)}};return v(h({},z(e)),{formRef:l,item:k,dialog:C,itemLoading:d,confirmLoading:_,cancelItem:m,confirmItem:b,getPermissionRoutes:t,lazyLoad:s})}},pe=g("\u83DC\u5355"),ue=g("\u52A8\u4F5C"),ce=g("ALL"),_e={style:{float:"left"}},fe={style:{float:"right"}},ge=g("\u53D6 \u6D88");function ye(e,t,r,l,k,C){const d=i("el-radio-button"),_=i("el-radio-group"),m=i("el-form-item"),b=i("el-cascader"),s=i("el-input"),u=i("el-option"),c=i("el-select"),f=i("e-icon-picker"),p=i("el-button"),L=i("el-form"),E=i("BasicDrawer"),W=Z("loading");return y(),w(E,{title:l.item.id?"\u7F16\u8F91\u6743\u9650":"\u65B0\u589E\u6743\u9650",modelValue:l.dialog,"onUpdate:modelValue":t[8]||(t[8]=n=>l.dialog=n),onClose:l.cancelItem},{default:a(()=>[x(o(L,{ref:"formRef",model:l.item,rules:e.rules,"label-width":"80px",size:"small"},{default:a(()=>[o(m,{label:"\u8282\u70B9\u7C7B\u578B",prop:"type"},{default:a(()=>[o(_,{modelValue:l.item.type,"onUpdate:modelValue":t[0]||(t[0]=n=>l.item.type=n),size:"mini"},{default:a(()=>[o(d,{label:"menu"},{default:a(()=>[pe]),_:1}),o(d,{label:"action"},{default:a(()=>[ue]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"\u7236\u7EA7\u8282\u70B9",prop:"pid"},{default:a(()=>[o(b,{modelValue:l.item.pid,"onUpdate:modelValue":t[1]||(t[1]=n=>l.item.pid=n),"show-all-levels":!1,props:{checkStrictly:!0,value:"id",label:"title",emitPath:!1,lazy:!0,lazyLoad:l.lazyLoad},clearable:"",style:{width:"100%"}},null,8,["modelValue","props"])]),_:1}),o(m,{label:"\u82F1\u6587\u6807\u8BC6",prop:"name"},{default:a(()=>[o(s,{modelValue:l.item.name,"onUpdate:modelValue":t[2]||(t[2]=n=>l.item.name=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(m,{label:"\u663E\u793A\u540D\u79F0",prop:"title"},{default:a(()=>[o(s,{modelValue:l.item.title,"onUpdate:modelValue":t[3]||(t[3]=n=>l.item.title=n),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l.item.type==="action"?(y(),w(m,{key:0,label:"\u8BF7\u6C42\u65B9\u5F0F",prop:"method"},{default:a(()=>[o(_,{modelValue:l.item.method,"onUpdate:modelValue":t[4]||(t[4]=n=>l.item.method=n),size:"small"},{default:a(()=>[o(d,{label:"GET"}),o(d,{label:"POST"}),o(d,{label:"PUT"}),o(d,{label:"DELETE"}),o(d,{label:"*"},{default:a(()=>[ce]),_:1})]),_:1},8,["modelValue"])]),_:1})):A("",!0),l.item.type==="action"?(y(),w(m,{key:1,label:"\u540E\u7AEFURL",prop:"url"},{default:a(()=>[o(s,{modelValue:l.item.url,"onUpdate:modelValue":t[5]||(t[5]=n=>l.item.url=n)},null,8,["modelValue"])]),_:1})):A("",!0),l.item.type==="menu"?(y(),w(m,{key:2,label:"\u524D\u7AEF\u8DEF\u7531",prop:"url"},{default:a(()=>[o(c,{modelValue:l.item.url,"onUpdate:modelValue":t[6]||(t[6]=n=>l.item.url=n),placeholder:"\u8BF7\u6C42\u65B9\u5F0F",style:{width:"100%"},filterable:""},{default:a(()=>[(y(!0),$(te,null,ee(l.getPermissionRoutes,(n,N)=>(y(),w(u,{key:N,value:n.path},{default:a(()=>[B("span",_e,I(n.path),1),B("span",fe,I(n.meta.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):A("",!0),l.item.type==="menu"?(y(),w(m,{key:3,label:"\u83DC\u5355\u56FE\u6807"},{default:a(()=>[o(f,{modelValue:l.item.icon,"onUpdate:modelValue":t[7]||(t[7]=n=>l.item.icon=n),size:"small"},null,8,["modelValue"])]),_:1})):A("",!0),o(m,null,{default:a(()=>[o(p,{onClick:l.cancelItem,size:"small"},{default:a(()=>[ge]),_:1},8,["onClick"]),o(p,{type:"primary",size:"small",onClick:l.confirmItem,loading:l.confirmLoading},{default:a(()=>[g(I(l.confirmLoading?"\u63D0\u4EA4\u4E2D ...":"\u786E \u5B9A"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"]),[[W,l.itemLoading]])]),_:1},8,["title","modelValue","onClose"])}var be=P(me,[["render",ye]]);const he=le({name:"index",components:{BasicQuery:J,BasicTable:O,EditTemplate:be,PageWrapper:M},setup(){const e=R({columns:[{prop:"id",label:"ID",width:100},{prop:"title",label:"\u663E\u793A\u540D\u79F0",minWidth:180,slot:"title"},{prop:"name",label:"\u82F1\u6587\u6807\u8BC6",minWidth:140},{prop:"type_label",label:"\u7C7B\u578B",minWidth:60},{prop:"method",label:"\u8BF7\u6C42\u65B9\u5F0F",minWidth:80},{prop:"url",label:"\u8DEF\u7531",minWidth:150},{prop:"created_at",label:"\u521B\u5EFA\u65F6\u95F4",minWidth:135}],schemas:[{field:"id",placeholder:"\u6743\u9650ID",component:"Input"},{field:"title",placeholder:"\u6743\u9650\u540D\u79F0",component:"Input"},{field:"name",placeholder:"\u6743\u9650\u6807\u8BC6",component:"Input"}]});let t=Y({listApi:ae,itemApi:ne,updateApi:ie,storeApi:re,deleteApi:se,item:{type:"menu"},refreshAfterConfirm:!1});const r=new Map,{confirmItem:l,deleteItem:k,getList:C,item:d}=t,_=async(s,u,c)=>{r.set(s.id,{tree:s,treeNode:u,resolve:c});const{data:{data:f}}=await q(s.id);c(f)},m=async()=>{const{tree:s,treeNode:u,resolve:c}=h({},r.get(d.value.pid));await l(),s?await _(s,u,c):await C()},b=async s=>{const{tree:u,treeNode:c,resolve:f}=h({},r.get(s.pid));await k(s),u?await _(u,c,f):await C()};return t=v(h({},t),{confirmItem:m,deleteItem:b}),D("resourceApi",t),D("childrenListApi",q),v(h(h({},z(e)),z(t)),{autoGenerateApi:de,loadChildren:_})}}),Ve=g("\u81EA\u52A8\u751F\u6210\u6743\u9650\u8282\u70B9"),we=g("\u65B0\u589E"),Ce={style:{"margin-left":"5px"}},ke=g("\u7F16\u8F91"),ve=g("\u5220\u9664");function Ae(e,t,r,l,k,C){const d=i("el-button"),_=i("BasicQuery"),m=i("el-card"),b=i("el-popconfirm"),s=i("el-table-column"),u=i("BasicTable"),c=i("EditTemplate"),f=i("page-wrapper");return y(),w(f,{title:e.$route.meta.title},{extra:a(()=>[o(d,{type:"primary",size:"mini",onClick:e.autoGenerateApi},{default:a(()=>[Ve]),_:1},8,["onClick"]),o(d,{type:"primary",size:"mini",onClick:e.addItem},{default:a(()=>[we]),_:1},8,["onClick"])]),default:a(()=>[o(m,{shadow:"none"},{default:a(()=>[o(_,{modelValue:e.query,"onUpdate:modelValue":t[0]||(t[0]=p=>e.query=p),schemas:e.schemas,onSubmit:e.getQuery},null,8,["modelValue","schemas","onSubmit"])]),_:1}),o(m,{shadow:"none",class:"mt-2"},{default:a(()=>[o(u,{"row-key":"id",lazy:"",columns:e.columns,data:e.lists,paginate:e.paginate,loading:e.listLoading,load:e.loadChildren,"tree-props":{children:"children",hasChildren:"children_count"},onChangePage:e.changePage},{title:a(p=>[B("span",{class:oe(p.row.icon)},null,2),B("span",Ce,I(p.row.title),1)]),default:a(()=>[o(s,{label:"\u64CD\u4F5C",width:"120"},{default:a(p=>[o(d,{type:"text",size:"small",onClick:L=>e.editItem(p.row)},{default:a(()=>[ke]),_:2},1032,["onClick"]),o(b,{title:"\u5220\u9664\u4F60\u662F\u8BA4\u771F\u7684\u5417\uFF1F",iconColor:"red",onConfirm:L=>e.deleteItem(p.row)},{reference:a(()=>[o(d,{type:"text",size:"small",disabled:p.row.name==="Administrator"},{default:a(()=>[ve]),_:2},1032,["disabled"])]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["columns","data","paginate","loading","load","onChangePage"]),o(c,{ref:"editTemplateRef",modelValue:e.dialog,"onUpdate:modelValue":t[1]||(t[1]=p=>e.dialog=p)},null,8,["modelValue"])]),_:1})]),_:1},8,["title"])}var je=P(he,[["render",Ae]]);export{je as default};
